---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# unglue

The package *unglue* features functions `unglue()`, `unglue_data()` and
`unglue_unnest()` which provides in many cases a more readable alternative to
regex. Simple cases indeed don't require regex knowledge at all.

It uses a syntax inspired from the functions of Jim Hester's *glue* package to 
extract matched substrings using a pattern, but is not endorsed by the authors 
of *glue* nor *tidyverse* packages.

It is completely dependency free.

## Installation:

```{r,eval=FALSE}
remotes::install_github("moodymudskipper/unglue")
```

## Examples

### using an example from `?glue::glue` backwards

```{r}
library(unglue)
library(glue)
library(magrittr)
glued_data <- head(mtcars) %>% glue_data("{rownames(.)} has {hp} hp")
glued_data
unglue_data(glued_data, "{rownames(.)} has {hp} hp")
```

### use several patterns, the first that matches will be used

```{r}
facts <- c("Antarctica is the largest desert in the world!",
"The largest country in Europe is Russia!",
"The smallest country in Europe is Vatican!",
"Disneyland is the most visited place in Europe! Disneyland is in Paris!",
"The largest island in the world is Green Land!")
facts_df <- data.frame(id = 1:5, facts)

patterns <- c("The {adjective} {place_type} in {bigger_place} is {place}!",
            "{place} is the {adjective} {place_type=[^ ]+} in {bigger_place}!{=.*}")
unglue_data(facts, patterns)
```

Note that the second pattern uses some regex, regex needs to be typed after an
`=` sign, if its has no left hand side then the expression won't be attributed 
to a variable. in fact the pattern `"{foo}"` is a shorthand for `"{foo=.*?}"`.

### usage in tidyverse code

`unglue()` is more suitable than `unglue_data()` in pipe chains:

```{r}
suppressMessages(library(tidyverse))
facts_df %>%
  mutate(unglued = unglue(facts, patterns)) %>%
  unnest()
```

However it is often moreconvenient to use `unglue_unnest()` which is very similar
but more compact and doesn't require any additional package :

```{r}
unglue_unnest(facts_df, facts, patterns)
unglue_unnest(facts_df, facts, patterns, keep = FALSE)
```

### escaping characters

Special characters outside of the curly braces should not be escaped.

```{r}
sentences <- c("666 is [a number]", "foo is [a word]", "42 is [the answer]", "Area 51 is [unmatched]")
patterns <- c("{number=\\d+} is [{what}]", "{word=\\D+} is [{what}]")
unglue_data(sentences, patterns)
```

### type conversion

Types are converted automatically so in the example above the column `number` 
is numeric.

To switch off the behavior set `convert = FALSE`

```{r}
unglue_data(sentences, patterns, convert = FALSE)
```
