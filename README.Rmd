---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```
# unglue

The package *unglue* features functions `unglue()` and `unglue_data()`
which use a syntax inspired from the functions of Jim Hester's *glue* package
to extract matched substrings using a pattern.

It wraps `stringr::str_match_all()` and `stringr::str_replace_all()` (doesn't
depend on *glue*) and provides in many cases a more readable alternative to
regex. Simple cases indeed don't require regex knowledge at all.

Installation:

```{r,eval=FALSE}
remotes::install_github("moodymudskipper/unglue")
```

## Examples

### using an example from `?glue::glue`

```{r}
library(unglue)
library(glue)
library(magrittr)
glued_data <- head(mtcars) %>% glue_data("{rownames(.)} has {hp} hp")
glued_data
unglue_data(glued_data, "{rownames(.)} has {hp} hp")
```

### use several patterns, the first that matches will be used

```{r}
facts <- c("Antarctica is the largest desert in the world!",
"The largest country in Europe is Russia!",
"The smallest country in Europe is Vatican!",
"Disneyland is the most visited place in Europe! Disneyland is in Paris!",
"The largest island in the world is Green Land!")
facts_df <- data.frame(id = 1:5, facts)

patterns <- c("The {adjective} {place_type} in {bigger_place} is {place}!",
            "{place} is the {adjective} {place_type=[^ ]+} in {bigger_place}!{=.*}")
unglue_data(facts, patterns)
```

Note that the second pattern uses some regex, regex needs to be typed after an
`=` sign, if its has no left hand side then the expression won't be attributed 
to a variable. in fact the pattern `"{foo}"` is a shorthand for `"{foo=.*?}"`.

`unglue()` is more suitable than `unglue_data()` in pipe chains:

```{r}
suppressMessages(library(tidyverse))
facts_df %>%
  mutate(unglued = unglue(facts, patterns)) %>%
  unnest()
```

It's not necessary to escape special characters outside of the curly braces.

```{r}
sentences <- c("666 is [a number]", "foo is [a word]", "42 is [the answer]", "Area 51 is [unmatched]")
patterns <- c("{number=\\d+} is [{what}]", "{word=\\D+} is [{what}]")
unglue_data(sentences, patterns)
```

Types are converted automatically so in the example the column `number` is numeric.

To switch off the behavior set `convert = FALSE`

```{r}
unglue_data(sentences, patterns, convert = FALSE)
```
